## ğŸš€ Luego puedes iniciar el microservicio:

    npm start

    (para correr en modo debug, cuando hay errores):
         DEBUG=* npm start


## ğŸš€ Microservicio Completo Implementado
### Endpoints Disponibles:
1. 1.
   POST /api/send-appointment-message
   
   - EnvÃ­a mensajes de citas mÃ©dicas con formato profesional
   - Tipos: confirmation , reminder , urgent_reminder , cancellation
   - Formateo automÃ¡tico de nÃºmeros argentinos
2. 2.
   GET /api/qr-code
   
   - Obtiene el cÃ³digo QR para setup inicial
   - Indica si ya estÃ¡ conectado
3. 3.
   GET /api/health
   
   - Estado completo del servicio
   - InformaciÃ³n de conexiÃ³n WhatsApp
   - Lista de endpoints disponibles



### Ejemplo de uso:
```
#Â EnviarÂ confirmaciÃ³nÂ deÂ cita
curlÂ -XÂ POSTÂ http://localhost:3000/api/send-appointment-messageÂ \
Â Â -HÂ "Content-Type:Â application/json"Â \
Â Â -dÂ '{
Â Â Â Â "phone":Â "+54Â 9Â 2346Â 33-4077",
Â Â Â Â "messageType":Â "confirmation",
Â Â Â Â "appointmentData":Â {
Â Â Â Â Â Â "patient":Â "AnaÂ GarcÃ­a",
Â Â Â Â Â Â "professional":Â "Dr.Â JuanÂ PÃ©rez",
Â Â Â Â Â Â "service":Â "ConsultaÂ CardiolÃ³gica",
Â Â Â Â Â Â "date":Â "15Â deÂ EneroÂ 2024",
Â Â Â Â Â Â "time":Â "14:30",
Â Â Â Â Â Â "location":Â "ClÃ­nicaÂ SanÂ JosÃ©Â -Â ConsultorioÂ 205"
Â Â Â Â }
}

```


# ğŸ—ï¸ Arquitectura del Microservicio WhatsApp
## ğŸ“‹ Estructura General
â”œâ”€â”€ server.js           # Servidor principal + endpoints especÃ­ficos
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ index.js        # Rutas web (frontend)
â”‚   â””â”€â”€ whatsapp.js     # API WhatsApp genÃ©rica
â”œâ”€â”€ services/
â”‚   â””â”€â”€ whatsappService.js  # LÃ³gica de conexiÃ³n WhatsApp
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ MessageBuilder.js   # Constructor de mensajes
â”‚   â””â”€â”€ logger.js          # Sistema de logs
â””â”€â”€ public/             # Archivos estÃ¡ticos

## ğŸ”Œ Endpoints Disponibles
### ğŸ“± Endpoints Principales (server.js)
- POST /api/send-appointment-message - EnvÃ­o de mensajes de citas mÃ©dicas
- GET /api/qr-code - Obtener QR para conectar WhatsApp
- GET /api/health - Estado del servicio

### ğŸ› ï¸ API WhatsApp GenÃ©rica (/api/whatsapp/)
- GET /status - Estado de conexiÃ³n
- GET /qr - QR code alternativo
- POST /send-message - EnvÃ­o genÃ©rico de mensajes
- GET /contacts - Lista de contactos
- GET /groups - Lista de grupos
- POST /logout - Cerrar sesiÃ³n


## âš™ï¸ Componentes Clave
### WhatsAppService
- Maneja conexiÃ³n con Baileys
- Persistencia de sesiÃ³n ( auth_info_baileys/ )
- Auto-reconexiÃ³n
- GeneraciÃ³n de QR codes
### MessageBuilder
- Construye mensajes de citas: confirmation , reminder , urgent_reminder , cancellation
- Soporte para texto, imÃ¡genes, documentos
- Formateo de nÃºmeros telefÃ³nicos argentinos
### Seguridad & LÃ­mites
- Rate limiting: 30 msg/min, 100 req/min
- CORS configurado
- Helmet para seguridad
- ValidaciÃ³n con Joi
## ğŸ¯ Flujo Principal
1. 1.
   Setup : GET /api/qr-code â†’ Escanear QR
2. 2.
   Verificar : GET /api/health â†’ Estado de conexiÃ³n
3. 3.
   Enviar : POST /api/send-appointment-message â†’ Mensaje de cita